<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

甲虫智慧停车接口文档
===========================
***

## 目录
* [接口调用说明](#1)
    * [API访问域名](#API服务器地址)
    * [API请求格式](#API请求格式)
    * [请求参数](#请求参数)
    * [响应](#响应)
    * [公共请求参数说明](#公共请求参数说明)
* [通用接口](#通用接口)
* [管理端相关接口](#管理端相关接口)
* [路边收费端相关接口](#路边收费端相关接口)
* [用户端相关接口](#用户端相关接口) 
* [道闸相关接口](#道闸相关接口)

***
## 1 接口调用说明
### 1.1 API访问域名
1. API正式环境访问域名：`http://api.jcbel.com` 
2. API测试环境访问域名：`http://api.jcbel.com` 
### 1.3 公共请求参数说明
注意：除特别声明外,每个API请求，都必须传入下面的基本参数
<table>
<th>参数名称</th>
<th>类型</th>
<th>参数描述</th>
	<tr>
		<td>sign</td>
		<td>string</td>
		<td>请求串的签名。签名算法详见签名参数sign生成说明。</td>
	</tr>
	<tr>
		<td>apptype</td>
		<td>int</td>
		<td>客户端类型 (0:Android 1:IOS 2:Web)
        </td>
	</tr>
</table>

### 1.4 查询参数说明
<table>
<th>参数名称</th>
<th>类型</th>
<th>参数描述</th>
	<tr>
		<td>limit</td>
		<td>int</td>
		<td>指定返回记录的数量,默认为30</td>
	</tr>
	<tr>
		<td>offset</td>
		<td>int</td>
		<td>指定返回记录的开始位置,默认从0开始</td>
	</tr>
	<tr>
		<td>sort</td>
		<td>int</td>
		<td>指定返回结果按照哪个属性排序</td>
	</tr>
</table>

### 1.2 API请求格式
`协议`+`域名`+`版本号`+`路径`+`查询参数`
例如获取所有停车场接口应为：`http://api.jcbel.com/v1/parkinglots?limit=10&offset=0`
### 1.5 请求参数
请求体(payload)通常都是一个JSON对象
以用户注册API为例，账号和密码都为字符串,那么请求体就是如下JSON对象:
<pre>
{
  "account": "",//用户账号,不能为空
  "password": "",//登录密码,不能为空
}
</pre>
### 1.6 响应
接口的响应为以下格式
<pre>
{
  "error": boolean,//有异常为true,否则为false
  "message": "", //有异常或错误则为具体的异常错误信息，否则为空
  "payload":{},//响应体,对象或数组
  "meta":{//附加信息 
    "total":'',//总的记录数
   }
}
</pre>


***
## 通用接口
### 2.1 获取4位手机验证码
- 请求路径 `/common/verify_code`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "mobile": ""//手机号码,不能为空
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "vcode":"1234"
  }
}
</pre>

***
## 3 管理员相关接口
### 3.1 登录
- 请求路径 `/admin/login`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "account": "",//管理员账号,不能为空
  "password": "",//管理员登录密码,不能为空
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "id":"",
	"name":"",
	"privileges":[
      {
        "pid":"",
        "pName":""
      }
	  ...
	]
  }
}
</pre>

### 3.2 找回密码
- 请求路径 `/admin/forgot_password`
- 请求方式 `PUT`
- 请求参数说明
<pre>
{
  "account": "",//管理员账号,不能为空
  "password": "",//管理员登录密码,不能为空
}
</pre>
响应
<pre>
{
  "error": false,
  "message": ""
}
</pre>

### 3.3 获取所有停车场信息
- 请求路径 `/parkinglots`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload":[
    {
      "id":"",
      "parkinglotName":"甲虫停车场",//停车场名称
    },
    ...
  ]
}
</pre>

### 3.4 获取车位信息
- 请求路径 `/parkings`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "parkinglot": "",//停车场
  "lockStatus":"",//车位锁状态
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": [
     {
       "parkingNo":"",//车位号
       "parkingLock":{
         "serialNumber":"",//车位锁串号
         "power":"",//车位锁电量
         "status":"",//车位锁状态
       },
       "geomagnetism":{
         "serialNumber":"",//地磁串号
         "power":"",//地磁电量
         "status":"",//地磁状态
       }
     },
     ...
  ]
}
</pre>
### 3.5 绑定设备到车位
- 请求路径 `/device`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "parkings":[
    {
      "parkingNo":"",//车位号
      "serialNumber":"",//设备串号
      "deviceType":""//设备类型  0：车位锁  1：地磁
    },
    ....
  ]
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 3.7 获取告警消息
- 请求路径 `/alarm_message`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "parkinglots": "",//停车场
  "deviceType":"",//设备类型
  "snagType":"",//故障类型
  "status":"",//处理状态
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": [
    {
      "content":"",//故障内容
      "time":"",//告警时间
      "status":""//处理状态
    },
    ...
  ]
}
</pre>
### 3.8 处理告警消息
- 请求路径 `/alarm_message/:id`
- 请求方式 `PUT`
- 请求参数说明
<pre>
{
  "status": "",//消息状态 0：未处理 1：已处理
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
}
</pre>
***
## 4 路边停车收费端相关接口
### 4.1 获取场内车辆信息
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 4.2 停车订单录入
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 4.3 收费记录
- 请求路径 `charge_records`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 4.4 未收费记录
- 请求路径 `oncharge_records`
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 4.5 收费
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 4.6 免单设置
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
***
## 5 用户端相关接口
### 5.1 用户注册
- 请求路径 `/user`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "phoneNumber": "",//手机号码
  "password":"",//登录密码
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.1 用户登录
- 请求路径 `/user/login`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "username": "",//用户名
  "password":"",//用户密码
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
  }
}
</pre>

### 5.4 用户获取个人信息
- 请求路径 `/user/profile/:userId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "userId":"",//用户id
    "balance":"",//用户余额
    "mobile":"",//手机号码
    "wechat":{
      "wechatAcc":"",//微信账号
      "nickname":""//微信昵称
    }
  }
}
</pre>
### 5.2 用户修改密码
- 请求路径 `/user/modify_password`
- 请求方式 `PUT`
- 请求参数说明
<pre>
{
  "account": "",//用户账号
  "password":"",//新的登录密码
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.3 忘记密码
- 请求路径 `/user/forgot-password`
- 请求方式 ``
- 请求参数说明
<pre>
{
  "account": "",//用户账号
  "password":"",//新的登录密码
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.4 绑定微信账号
- 请求路径 `/user/:userId/wechat`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "wechatAcc":"",//微信账号
  "nickname":""//微信昵称
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.5 解除微信账号绑定
- 请求路径 `/user/:userId/wechat/:wechatId`
- 请求方式 `DELETE`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>

### 5.8 用户获取个人车辆信息
- 请求路径 `/cars/:userId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload":[
    {
      "id":"",//
      "carNumber":"",//车牌号
      "status":""//状态  0:未入场 1：已预约 2：已入场 3：已缴费未出场
    }
    ...
  ]
}
</pre>
### 5.9 添加用户车辆信息
- 请求路径 `/car/:userId`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "carNumber": "",//车牌号码
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.10 删除用户绑定车辆信息
- 请求路径 `/car/:carId`
- 请求方式 `DELETE`
- 请求参数说明
<pre>
{
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.11 预订车位
- 请求路径 `/reservation_order`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "userId": "",//用户id
  "carNumber":"",//车牌号
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.12 取消预约
- 请求路径 `/reservation_order `
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.13 获取个人停车订单记录
- 请求路径 `/orders/:userId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.13 获取停车订单详情
- 请求路径 `/parkingOrder/:orderId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "carNumber":"",//车牌号
    "intime":"",//入场时间
    "intime":"",//结算时间
    "totalFee":"",//总费用
    "payedFee":"",//已支付费用
    "unpayFee":"",//为缴纳费用
    "payStatus":""//支付状态
  }
}
</pre>
### 5.14 获取个人预约订单记录
- 请求路径 `/orders/:userId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": [
    {
      "parkinglot":"",//停车场
      "parkingNo":"",//车位号
      "time":"",//预订时长
      "fee":"",//预订费用
      "":"",//
      "":"",//
      "":"",//
    }
  ]
}
</pre>
### 5.15 获取附近停车场
- 请求路径 `/parkinglots?range=xxx`
- 请求方式 `GET`
- 请求参数说明
<pre>
{
  "x": "",//当前位置x坐标
  "y":"",//当前位置y坐标
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload":[
     {
       "id":"",
       "parkinglotName":"甲虫停车场",  //停车场名称
       "totalCount":1000,  //总的车位数
       "freeCount":1000,  //空闲车位数
       "revatationCount":1000,  //可预约车位
       "freeTime":1000,  //免费停车时长
       "havaMap":"",  //是否有室内地图
       "havaLock":"",  //是否有车位锁
       "chargeRules":{ //收费规则
         
       }
     },
     ...
   ]
}
</pre>
### 5.16 获取停车场详情
- 请求路径 `/parkinglot/:parkinglotId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "id":"",
    "parkinglotName":"甲虫停车场",//停车场名称
    "totalCount":1000,//总的车位数
    "freeCount":1000,//空闲车位数
    "revatationCount":1000,//可预约车位
    "freeTime":1000,//免费停车时长
    "havaMap":"",//是否有室内地图
    "havaLock":"",//是否有车位锁
    "chargeRules":{//收费规则
 
    }
  }
}
</pre>
### 5.17 申请开发票
- 请求路径 `/invoice/application`
- 请求方式 `POST`
- 请求参数说明
<pre>
{
  "userId": "",//
  "order":[
    {
      "orderId":""//停车订单id
    },
    ...
  ]
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 5.18 用户获取个人发票记录
- 请求路径 `/invoices/:userId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload":[
    {
      "order_no"：""//订单号码
      "date":"",//开票时间
      "acount":"",//开票金额
      "status":""//发票状态 0：已申请 1：已完成
    },
    ...
  ]
  "meta":{
  }
}
</pre>
### 5.19 发票详情
- 请求路径 `/invoice/:invoiceId`
- 请求方式 `GET`
- 请求参数说明
<pre>
{

}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {
    "order_no":"",//订单号码
    "money":"",//发票金额
    "invoiceTitle":"",发票抬头
    "status":"",//开票状态  0:已申请  1:已完成
    "receiver":"",//收件人
    "linkman":"",//联系人
    "address":""//收件地址
  }
}
</pre>
***

<h2 id="道闸相关接口">道闸相关接口</h2>
### 6.1 车辆入场
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>
### 6.2 车辆出场
- 请求路径 ``
- 请求方式 ``
- 请求参数说明
<pre>
{
  "": "",//
  "":"",//
}
</pre>
响应
<pre>
{
  "error": false,
  "message": "",
  "payload": {}
}
</pre>






















